# 6.数据库查询

## 6.1 DQL基本查询

DQL语言用来检索表中数据的语言，涉及到的关键字SELECT

### 1.1 **基础查询**

`SELECT 字段1,字段2,... FROM 表名;`

### 1.2 WHERE子句

WHERE同样用于指定过滤条件，此时仅将满足该过滤条件的记录查询出来

算术运算符

+、-、*、/或DIV、%

逻辑运算符

NOT AND OR

AND地优先级高于OR，为了提高OR的优先级，可以使用小括号()

比较运算符

=、!=、>、<、<=、>=、BETWEEN、IN、IS NULL


## 6.2 DQL高级查询

### 1.模糊查询

LIKE 有两个可用的通配符

_：表示任意一个字符。确切的数量表示1个字符
%：表示任意个字符。不确切的数量表示0-任意个字符

例：查询名字中有平的学生

```
SELECT name
FROM student
WHERE name LIKE '%平%';
```

### 2.AS别名

语法格式：字段名<空格>别名
别名通常使用在SELECT子句和FROM子句中
当字段为函数或表达式时，我们通常给字段添加别名，为了增加可读性

```
# AS 关键字可以省略不写
SELECT name,salary,salary*12 AS annusal
FROM teacher;
```

### 3. ORDER BY排序

升序：ORDER BY 字段 ASC 将当前结果集按照指定的字段值从小到大排序。

降序：ORDER BY 字段 DESC 将当前结果集按照指定的字段值从大到小排序。

ORDER BY可以按照多个字段排序

首先按照第1个字段将结果集按照该字段排序方式(升序或降序)排序

排序后再按照第2个字段排序，仅会对第一个字段值相同的记录按照第二个字段排序

### 4.LIMIT 分页查询

LIMIT 子句用于限制由 SELECT 语句返回的数据数量

当一条DQL语句可以查询出非常大量的数据时，我们可以分批将数据查询，例如淘宝检索一件商品时，分出现第一页，第二页等信息，每页展示30条记录。一次仅查询30条记录，避免因为数据庞大导致系统过度的资源开销。

语法

```
SELECT ...
FROM ...
WHERE ...
ORDER BY ...
LIMIT M,N;
```

M：表示跳过结果集M条记录
N：表示从跳过的M条记录后连续检索N条记录
在分页查询中有两个常见的参数
页数:当前显示第几页内容
条目数:每页显示的条目数


## 6.3 聚合操作

聚合操作指的是在数据查找基础上对数据的进一步整理筛选行为，实际上聚合操作也属于数据的查询筛选范围。

### 1. 聚合函数

|     方法     |         功能         |
| :-------------: | :--------------------: |
|   AVG(字段)   |   该字段的平均值<br />   |
|  MAX(字段名)  |    该字段的最大值    |
|  MIN(字段名)  |    该字段的最小值    |
|  SUM(字段名)  |  该字段所有记录的和  |
| COUNT(字段名) | 统计该字段记录的个数 |

MIN、MAX、SUM、AVG是对值的统计；而COUNT是对记录数的统计
聚合函数忽略NULL值；

### 2. GROUP BY 分组

GROUP BY子句可以将结果集按照指定字段值相同的记录进行分组。

在SELECT子句中出现聚合函数时，那么不在聚合函数中的字段都要出现在GROUP BY子句中。
GROUP BY子句是配合聚合函数使用的，如果SELECT子句中没有聚合函数，通常不写GROUP BY。

### 3. HAVING子句

HAVING子句是紧跟在GOURP BY子句之后，用于对分组进行过滤的子句。

WHERE是在第一次检索表数据时用于添加过滤条件，确定结果集。

HAVING是在GROUP BY之后(将结果集分组之后)添加过滤条件的，用于确定分组。

例，查看每个科目老师的平均工资，前提是该科目老师最高工资要超过9000

```
SELECT AVG(salary),subject_id 
FROM teacher
GROUP BY subject_id 
HAVING MAX(salary)>9000;
```

### 4.DISTINCT去重

DISTINCT可以将结果集按照指定的字段去除重复行；
DISTINCT必须紧跟在SELECT关键字之后。
